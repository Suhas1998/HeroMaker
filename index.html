<!DOCTYPE html>
<html>
<head>
  <title></title>

  <!--  load jQuery, Bootstrap, Firebase-->

  <!--  jQuery -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

</head>
<body>
  <!-- HTML FORMS -->

  <!-- Edit Modal -->


  <div class="modal" id="edit-hero" tabindex="-1" role="dialog">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Edit this Hero</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="container p-3" id="edit-hero">
            <div class="card bg-light p-3 ">
              <form>
                <input type="hidden" class="form-control" id="heroid" >

                <div class="form-group">
                  <label for="edit-inputHeroName">Hero Name</label>
                  <input type="text" class="form-control" id="edit-inputHeroName" placeholder="HeroName">
                </div>
                <div class="form-group">
                  <label for="edit-hero-race">Hero Race:</label>
                  <select class="form-control" name="edit-hero-race" id="edit-hero-race">
                    <option value="Wizard">Wizard</option>
                    <option value="Ork">Ork</option>
                    <option value="Elf">Elf</option>
                    <option value="Human">Human</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="edit-hero-profession">Hero Profession:</label>
                  <select class="form-control" name="edit-hero-profession" id="edit-hero-profession">
                    <option value="Armorer">Armorer</option>
                    <option value="Cobbler">Cobbler</option>
                    <option value="Stone Mason">Stone Mason</option>
                    <option value="Forger">Forger</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="edit-hero-strength">Hero Strength: <span class="attrib-value">50</span> </label>
                  <input class="form-control slider hero-sss" type="range" min="1" max="100" value="50" id="edit-hero-strength" name="edit-hero-strength">
                </div>
                <div class="form-group">
                  <label for="edit-hero-speed">Hero Speed: <span class="attrib-value">50</span> </label>
                  <input class="form-control slider hero-sss" type="range" min="1" max="100" value="50"  id="edit-hero-speed" name="edit-hero-speed">
                </div>
                <div class="form-group">
                  <label for="edit-hero-stamina">Hero Stamina: <span class="attrib-value">50</span> </label>
                  <input class="form-control slider hero-sss" type="range" min="1" max="100" value="50" id="edit-hero-stamina" name="edit-hero-stamina">
                </div>

                <!-- <button type="button" class="btn btn-primary btn-block" id="edit-hero-btn">Edit Hero</button> -->
              </form>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" data-dismiss="modal" id="update-hero">Save changes</button>
        </div>
      </div>
    </div>
  </div>

  <div class="container p-3" id="login-form">
    <div class="card bg-light p-3 ">
      <h3>Please Sign in or Create a new account</h3>
      <form>
        <div class="form-group">
          <label for="inputEmail">Email address</label>
          <input type="email" class="form-control" id="inputEmail" aria-describedby="emailHelp">
          <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
        </div>
        <div class="form-group">
          <label for="inputPassword">Password</label>
          <input type="password" class="form-control" id="inputPassword">
        </div>

        <button type="button" class="btn btn-primary btn-block" id="sign-in-btn">Sign In</button>
        <button type="button" class="btn btn-warning btn-block" id="create-newuser-btn">Create new User</button>
        <button type="button" class="btn btn-primary btn-block" id="google-login-btn">Sign In with Google</button>

      </form>
    </div>
  </div>

  <hr>
  <div class="container p-3" id="logout">
    <button type="button" class="btn btn-primary btn-block" id="logout-btn">Log Out</button>
  </div>
  <hr>

  <!-- Show Heroes -->
  <div class="container p-3" >
    <div class="card bg-light p-3 " id="show-heroes">
      <h3>Show Heroes</h3>
    </div>
  </div>
  <!-- Hero Form -->
  <div class="container p-3" id="add-hero">
    <div class="card bg-light p-3 ">
      <h3>Create a new Hero</h3>
      <form>
        <label for="inputHeroName">Hero Name</label>
        <div class="form-group">
          <input type="text" class="form-control" id="inputHeroName" placeholder="HeroName">
        </div>
        <div class="form-group">
          <label for="hero-race">Hero Race:</label>
          <select class="form-control" name="hero-race" id="hero-race">
            <option value="Wizard">Wizard</option>
            <option value="Ork">Ork</option>
            <option value="Elf">Elf</option>
            <option value="Human">Human</option>
          </select>
        </div>
        <div class="form-group">
          <label for="hero-profession">Hero Profession:</label>
          <select class="form-control" name="hero-profession" id="hero-profession">
            <option value="Armorer">Armorer</option>
            <option value="Cobbler">Cobbler</option>
            <option value="Stone Mason">Stone Mason</option>
            <option value="Forger">Forger</option>
          </select>
        </div>
        <div class="form-group">
          <label for="hero-strength">Hero Strength: <span class="attrib-value">50</span> </label>
          <input class="form-control slider hero-sss" type="range" min="1" max="100" value="50" id="hero-strength" name="hero-strength">
        </div>
        <div class="form-group">
          <label for="hero-speed">Hero Speed: <span class="attrib-value">50</span> </label>
          <input class="form-control slider hero-sss" type="range" min="1" max="100" value="50"  id="hero-speed" name="hero-speed">
        </div>
        <div class="form-group">
          <label for="hero-stamina">Hero Stamina: <span class="attrib-value">50</span> </label>
          <input class="form-control slider hero-sss" type="range" min="1" max="100" value="50" id="hero-stamina" name="hero-stamina">
        </div>

        <button type="button" class="btn btn-primary btn-block" id="create-newhero-btn">Create New Hero</button>
      </form>
    </div>
  </div>



<!-- Scripts -->

  <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-app.js"></script>

  <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
  <script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-analytics.js"></script>

  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-database.js"></script>
<!--   <script src="https://www.gstatic.com/firebasejs/7.16.1/firebase-firestore.js"></script> -->

  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyBw8MyPo6p1wJu8sf95yuK-QBx2szoNYO8",
      authDomain: "heromaker-6bb38.firebaseapp.com",
      databaseURL: "https://heromaker-6bb38.firebaseio.com/",
      projectId: "heromaker-6bb38",
      storageBucket: "heromaker-6bb38.appspot.com",
      messagingSenderId: "1062959283346",
      appId: "1:1062959283346:web:9d2af814ab4ac217c0ba4b",
      measurementId: "G-JSE8RF3083"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();
    var database = firebase.database();
  </script>

  <script>

    var currentUser = {};

    $("#create-newuser-btn").click(function(){
      var email = $("#inputEmail").val();
      var password = $("#inputPassword").val();
      console.log("New User= "+ email + " " + password);
      CreateNewUser(email, password);
    });

    $("#sign-in-btn").click(function(){
          var email = $("#inputEmail").val();
          var password = $("#inputPassword").val();
          console.log("Existing User= "+ email + " " + password);
          SignIn(email, password);
    });

    $("#logout-btn").click(function(){
          firebase.auth().signOut();
          console.log("User Signed out")
    });

    $("#create-newhero-btn").click(function(){

      var hero = {
        id: $("#inputHeroName").val() + Date.now(),
        owner: currentUser.uid,
        name : $("#inputHeroName").val(),
        race : $("#hero-race :selected").val(),
        profession : $("#hero-profession :selected").val(),
        strength : $("#hero-strength").val(),
        speed : $("#hero-speed").val(),
        stamina : $("#hero-stamina").val()
      }

      AddHeroToDatabase(hero);

    });

    $("#update-hero").click(function(){
      console.log("Update clicked");
      var hero = {
        id: $("#heroid").val(),
        owner: currentUser.uid,
        name : $("#edit-inputHeroName").val(),
        race : $("#edit-hero-race :selected").val(),
        profession : $("#edit-hero-profession :selected").val(),
        strength : $("#edit-hero-strength").val(),
        speed : $("#edit-hero-speed").val(),
        stamina : $("#edit-hero-stamina").val()
      }

      AddHeroToDatabase(hero);

    });

    $(document).on("click", ".delete-hero", function(){
      var heroID = $(this).attr('id');
      console.log(heroID);
      firebase.database().ref("heroes/" + heroID).remove();
      console.log("Removed in hero field");
      firebase.database().ref("users/" + currentUser.uid +  "/heroes/" + heroID).remove();
      console.log("Removed in User field");
    });

    $(".hero-sss").on("change input", function(){
      var currentvalue = $(this).val();
      $(this).parent().find("span").text(currentvalue);
    });

    $(document).on("click", ".edit-hero-btn", function(){
      var heroid = $(this).attr("data-heroid");
      $("#heroid").val(heroid);
      $("#edit-inputHeroName").val($(this).parent().find(".hero-data-name").text());
      $("#edit-hero-race").val($(this).parent().find(".hero-data-race").text()).change();
      $("#edit-hero-profession").val($(this).parent().find(".hero-data-profession").text()).change();
      $("#edit-hero-stamina").val($(this).parent().find(".hero-data-stamina").text()).change();
      $("#edit-hero-speed").val($(this).parent().find(".hero-data-speed").text()).change();
      $("#edit-hero-strength").val($(this).parent().find(".hero-data-strength").text()).change();
    });



    function AddHeroToDatabase(h){
      firebase.database().ref('heroes/' + h.id).set(h);
      firebase.database().ref('users/' + currentUser.uid + "/heroes/" + h.id).set(h);
    }

    function CreateNewUser(email, password){
      firebase.auth().createUserWithEmailAndPassword(email, password).catch(function(error) {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        // ...
      });

    }

    function writeUserData(user) {
      firebase.database().ref('users/' + user.uid).set({
        email: user.email
      });
    }

    function SignIn(email, password){
      firebase.auth().signInWithEmailAndPassword(email, password).catch(function(error) {
        // Handle Errors here.
        var errorCode = error.code;
        var errorMessage = error.message;
        console.log(errorMessage);
        alert();
        // ...
      });
    }


    var heroReference = firebase.database().ref().child("heroes");
    heroReference.on("value", function(snapshot){
      $("#show-heroes").empty();
      var heroHTMLitem = "<h3> Here are the Heroes that we created</h3>";
      snapshot.forEach(function(childsnapshot){
        var person = childsnapshot.val();
        heroHTMLitem += "<div class='heroHTMLitem '><hr><ul>";
        heroHTMLitem += "<li>Name: <span class='hero-data-name'>" + person.name + "</span></li>";
        heroHTMLitem += "<li>Race: <span class='hero-data-race'>" + person.race + "</span></li>";
        heroHTMLitem += "<li>Profession: <span class='hero-data-profession'>" + person.profession + "</span></li>";
        heroHTMLitem += "<li>Strength: <span class='hero-data-strength'>" + person.strength + "</span></li>";
        heroHTMLitem += "<li>Speed: <span class='hero-data-speed'>" + person.speed + "</span></li>";
        heroHTMLitem += "<li>Stamina: <span class='hero-data-stamina'>" + person.stamina + "</span></li>";
        heroHTMLitem += "</ul>";
        heroHTMLitem += "<button type='button' class='btn btn-danger delete-hero' id='" + person.id + "'>Delete Me</button>";
        heroHTMLitem += "<button type='button' class='btn btn-primary edit-hero-btn' data-toggle='modal' data-heroid='"+ person.id +"'data-target='#edit-hero'>Edit Me</button>";
        heroHTMLitem += "</div>";
      });
      $("#show-heroes").html(heroHTMLitem);
    });

    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        // User is signed in.
        var email = user.email;
        currentUser = user;
        writeUserData(user);
        console.log(currentUser.email + " Has logged in");
        // ...
      } else {
        // User is signed out.
        // ...
      }
    });

  </script>

</body>
</html>
